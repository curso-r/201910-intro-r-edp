---
title: "Preço da Energia"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(lubridate)
library(readxl)
library(knitr)

theme_set(theme_minimal(12))

# Exercício 1: carregar base BD.xlsx usando a função read_excel()
bd <- read_excel("../dados/BD.xlsx")

bd_arrumado <- bd %>%
  mutate(
    data = paste(Ano, Mês, Dia, sep = "-") %>% as.Date()
  )

glimpse(bd_arrumado)
```

Chuvas
=======================================================================

primeira fileira 
-----------------------------------------------------------------------

### Precipitação Média (S)

```{r}
valor <- bd$ChuvaS %>% mean() %>% round(2)




valueBox(value = valor)
```

### Precipitação Média (SE)

```{r}
valor <- bd$ChuvaSE %>% mean() %>% round(2)
valueBox(value = valor)
```

### Nível Último Mês (S)

```{r}
ultimo_mes <- bd_arrumado %>%
  mutate(
    ano_mes = floor_date(data, "months"),
    mes = month(data, label = TRUE)
  ) %>%
  filter(
    Ano == max(Ano)
  ) %>%
  filter(
    Mês == max(Mês)
  )

valor <- ultimo_mes$ChuvaS %>% mean() %>% round(2)
valueBox(value = valor)
```

### Precipitação Último Mês (SE)

```{r}
bd_aux <- bd_arrumado %>%
  mutate(
    ano_mes = floor_date(data, "months")
  ) %>%
  filter(ano_mes == max(ano_mes))

valor <- bd_aux$ChuvaSE %>% mean() %>% round(2)
valueBox(value = valor)
```


primeira fileira 
-----------------------------------------------------------------------

### Chuvas SE vs S

```{r, fig.width=7}
p1 <- bd_arrumado %>%
  ggplot(aes(x = ChuvaSE, y = ChuvaS)) +
  geom_point()

plotly::ggplotly(p1)
```

### Sumário
```{r}
bd_arrumado %>%
  gather(regiao, precipitacao, starts_with("Chuva"))  %>% View
```

```{r}
bd_arrumado %>%
  gather(regiao, precipitacao, starts_with("Chuva")) %>%
  group_by(Ano, `Mês`, regiao) %>%
  summarise(
    dias = n(),
    `Média` = mean(precipitacao, na.rm = TRUE) %>% round(2),
    `Desv.P` = sd(precipitacao, na.rm = TRUE) %>% round(2),
    `Máx` = max(precipitacao, na.rm = TRUE),
    `Min` = min(precipitacao, na.rm = TRUE)
  ) %>%
  rename(
    `Região` = regiao
  ) %>%
  kable()
```


segunda fileira
-----------------------------------------------------------------------

### Precipitação no tempo

```{r, fig.width=20}
p3 <- bd_arrumado %>%
  gather(regiao, precipitacao, starts_with("Chuva")) %>%
  ggplot(aes(x = data, y = precipitacao, colour = regiao)) +
  geom_line() +
  scale_x_date(breaks = "2 months", date_labels = "%y-%b") +
  theme_minimal(12) +
  theme(legend.position = "top")

plotly::ggplotly(p3)
```

> Aqui vai uma descrição sobre o que se observou no gráfico.

ENA
=======================================================================

primeira fileira 
-----------------------------------------------------------------------

### ENA Média (S)

```{r}
valor <- bd_arrumado$ENASperc %>% mean() %>% round(2)
valueBox(value = valor)
```

### ENA Média (SE)

```{r}

valor <- bd_arrumado$ENASEperc %>% mean() %>% round(2)
valueBox(value = valor)
```

### ENA Último Mês (S)

```{r}
ultimo_mes <- bd_arrumado %>%
  filter(
    Ano == max(Ano)
  ) %>%
  filter(
    `Mês` == max(`Mês`)
  )

valueBox(value = ultimo_mes$ENASperc %>% mean() %>% round(2))
```

### ENA Último Mês (SE)

```{r}
valueBox(value = ultimo_mes$ENASEperc %>% mean() %>% round(2))
```

segunda fileira
-----------------------------------------------------------------------

### ENA SE vs S

```{r}
p1 <- bd_arrumado %>%
  ggplot(aes(x = ENASEperc, y = ENASperc)) +
  geom_point() 

plotly::ggplotly(p1)
```

### Sumário

```{r}
bd_arrumado %>%
  gather(regiao, enaperc, ENASEperc, ENASperc) %>%
  group_by(Ano, Mês, regiao) %>%
  summarise(
    dias = n(),
    `Média` = mean(enaperc) %>% round(2),
    `Desv.P` = sd(enaperc) %>% round(2)
  ) %>%
  kable()
```


terceira fileira 
-----------------------------------------------------------------------

### ENA no tempo

```{r}
p2 <- bd_arrumado %>%
  gather(regiao, enaperc, ENASEperc, ENASperc) %>%
  ggplot(aes(x = data, y = enaperc, colour = regiao)) +
  geom_line() 

  plotly::ggplotly(p2)
```


Merc+1
=========================================================================================

--------------------------------

### Histograma de Merc+1

```{r}
bd_arrumado %>%
  ggplot() +
  geom_histogram(aes(x = `Merc+1`), color = "white")
```


- Instruções:
- 1) Crie uma fileira única
- 2) Crie um título
- 3) abaixo do título crie um CHUNK de R 
- 4) Faça um gráfico do histograma da coluna `Merc+1` usando ggplot2 e geom_histogram()


Dados 
=========================================================================================

fileira unica {.tabset}
------------------------------------------------------

### Usando kable 

```{r}
bd_arrumado %>% kable()
```

### Usando DataTable

```{r}
library(DT)
bd_arrumado %>% datatable(filter = "bottom")
```





Anotações {data-orientation=columns}
============================================

<h4>Próximos passos</h4>

1. reparar que dá para colocar código HMTL no texto.
2. revisitar os graficos e colocar ggplotly() onde lhe convier.
3. solicitar ao professor para falar sobre graficos waterfall.

<h4>Referências</h4>

- [rmarkdown](https://rmarkdown.rstudio.com/lesson-1.html)
- [rmarkdown book](https://bookdown.org/yihui/rmarkdown/)
- [flexdashboard](https://rmarkdown.rstudio.com/flexdashboard/using.html)
- [kable](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)
- [bookdown](https://bookdown.org/yihui/bookdown/get-started.html)

